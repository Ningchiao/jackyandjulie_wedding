import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

// Firebase 設定
const firebaseConfig = {
  apiKey: "你的 apiKey",
  authDomain: "你的 authDomain",
  projectId: "你的 projectId",
  storageBucket: "你的 storageBucket",
  messagingSenderId: "你的 senderId",
  appId: "你的 appId"
};

// 初始化
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// 指定 Firestore 文件 (必須偶數層)
const appId = "demoApp";   // 這邊換成你在首頁選的隊伍代號
const docRef = doc(db, "artifacts", appId, "game_data", "game-scores");

// 匿名登入
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    await signInAnonymously(auth);
  }
});

// 監聽分數
onSnapshot(docRef, (snap) => {
  if (snap.exists()) {
    const data = snap.data();
    // 假設這個玩家是 team1
    document.getElementById("score").textContent = data.team1 ?? 0;
  }
});

// 綁定點擊事件
document.getElementById("broccoliIcon").addEventListener("click", async () => {
  await setDoc(docRef, { team1: increment(1) }, { merge: true });
});
